{
  "template_name": "power-query",
  "version": "1.0.0",
  "description": "Template for Power Query (M language) projects with Phase 0 ambiguity resolution, LLM pitfalls checklist, 5-dimension difficulty scoring, and Bronze-Silver-Gold data architecture",
  "included_components": [
    {
      "name": "task-management",
      "path": "../../components/task-management",
      "version": "1.0.0",
      "required": true,
      "description": "Hierarchical task tracking with Power Query specific 5-dimension difficulty scoring (Logic Complexity, M Language, Dependency, Data Quality, Ambiguity)"
    }
  ],
  "customizations": [
    {
      "category": "context",
      "files": [
        {
          "name": "overview.md",
          "path": "context/overview.md",
          "destination": ".claude/context/overview.md",
          "description": "Project-specific overview with goals, success criteria, and special requirements (customized during initialization)"
        },
        {
          "name": "critical_rules.md",
          "path": "context/critical_rules.md",
          "destination": ".claude/context/critical_rules.md",
          "description": "Critical rules for Power Query development including null handling, type safety, performance, and error patterns"
        },
        {
          "name": "llm-pitfalls.md",
          "path": "context/llm-pitfalls.md",
          "destination": ".claude/context/llm-pitfalls.md",
          "description": "Pre-populated checklist of common LLM mistakes in Power Query (null handling, type conversion, Table.* operations, etc.)"
        },
        {
          "name": "data-architecture.md",
          "path": "context/data-architecture.md",
          "destination": ".claude/context/data-architecture.md",
          "description": "Bronze-Silver-Gold data architecture pattern for Power Query projects"
        },
        {
          "name": "validation-rules.md",
          "path": "context/validation-rules.md",
          "destination": ".claude/context/validation-rules.md",
          "description": "Power Query specific validation rules and schema checking patterns"
        }
      ]
    },
    {
      "category": "standards",
      "files": [
        {
          "name": "power-query.md",
          "path": "context/standards/power-query.md",
          "destination": ".claude/context/standards/power-query.md",
          "description": "Power Query M language coding standards including null handling, type safety, performance optimization, and defensive programming"
        },
        {
          "name": "naming.md",
          "path": "context/standards/naming.md",
          "destination": ".claude/context/standards/naming.md",
          "description": "Naming conventions for queries, columns, parameters, and variables in Power Query"
        },
        {
          "name": "error-handling.md",
          "path": "context/standards/error-handling.md",
          "destination": ".claude/context/standards/error-handling.md",
          "description": "Error handling patterns and try/otherwise blocks in Power Query"
        }
      ]
    },
    {
      "category": "commands",
      "files": [
        {
          "name": "initialize-project.md",
          "path": "commands/initialize-project.md",
          "destination": ".claude/commands/initialize-project.md",
          "description": "Phase 0 Step 1: Analyze calculation documents, Excel files, and identify ambiguities"
        },
        {
          "name": "resolve-ambiguities.md",
          "path": "commands/resolve-ambiguities.md",
          "destination": ".claude/commands/resolve-ambiguities.md",
          "description": "Phase 0 Step 2: Interactive ambiguity resolution (run multiple times in batches of 5)"
        },
        {
          "name": "generate-artifacts.md",
          "path": "commands/generate-artifacts.md",
          "destination": ".claude/commands/generate-artifacts.md",
          "description": "Phase 0 Step 3: Generate glossary, assumptions, data contracts, query manifest, and task breakdown"
        },
        {
          "name": "extract-queries.md",
          "path": "commands/extract-queries.md",
          "destination": ".claude/commands/extract-queries.md",
          "description": "Phase 0 Step 4: Extract Power Query .m files from Excel workbooks using Excel Power Query Editor extension"
        },
        {
          "name": "validate-query.md",
          "path": "commands/validate-query.md",
          "destination": ".claude/commands/validate-query.md",
          "description": "Validate Power Query against expected schema and check for common pitfalls"
        },
        {
          "name": "breakdown.md",
          "path": "commands/breakdown.md",
          "destination": ".claude/commands/breakdown.md",
          "description": "Break down tasks with difficulty â‰¥7 using 5-dimension scoring"
        },
        {
          "name": "complete-task.md",
          "path": "commands/complete-task.md",
          "destination": ".claude/commands/complete-task.md",
          "description": "Execute a task with pre-flight pitfalls check and post-validation"
        },
        {
          "name": "sync-tasks.md",
          "path": "commands/sync-tasks.md",
          "destination": ".claude/commands/sync-tasks.md",
          "description": "Update task-overview.md from individual task JSON files"
        },
        {
          "name": "update-tasks.md",
          "path": "commands/update-tasks.md",
          "destination": ".claude/commands/update-tasks.md",
          "description": "Validate task system health and fix inconsistencies"
        }
      ]
    },
    {
      "category": "reference",
      "files": [
        {
          "name": "difficulty-guide-pq.md",
          "path": "reference/difficulty-guide-pq.md",
          "destination": ".claude/reference/difficulty-guide.md",
          "description": "Power Query specific 5-dimension difficulty scoring guide (Logic, M Language, Dependency, Data Quality, Ambiguity)"
        },
        {
          "name": "pq-scoring-explained.md",
          "path": "reference/pq-scoring-explained.md",
          "destination": ".claude/reference/pq-scoring-explained.md",
          "description": "Detailed explanation of how 5-dimension scoring works with examples"
        },
        {
          "name": "breakdown-workflow.md",
          "path": "reference/breakdown-workflow.md",
          "destination": ".claude/reference/breakdown-workflow.md",
          "description": "Power Query specific breakdown workflow with examples"
        }
      ]
    }
  ],
  "directory_structure": {
    ".claude": {
      "commands": [
        "initialize-project.md (Phase 0 Step 1)",
        "resolve-ambiguities.md (Phase 0 Step 2)",
        "generate-artifacts.md (Phase 0 Step 3)",
        "extract-queries.md (Phase 0 Step 4)",
        "validate-query.md",
        "complete-task.md",
        "breakdown.md",
        "sync-tasks.md",
        "update-tasks.md"
      ],
      "context": {
        "overview.md": "Project overview (customized during initialization)",
        "critical_rules.md": "Power Query critical rules (from template)",
        "llm-pitfalls.md": "LLM pitfalls checklist (from template)",
        "data-architecture.md": "Bronze-Silver-Gold architecture (from template)",
        "validation-rules.md": "PQ validation rules (from template)",
        "glossary.md": "Generated during Phase 0 Step 3",
        "assumptions.md": "Generated during Phase 0 Step 2",
        "standards": [
          "power-query.md (from template)",
          "naming.md (from template)",
          "error-handling.md (from template)"
        ]
      },
      "tasks": [
        "task-overview.md (auto-generated)",
        "task-*.json (created during Phase 0 Step 3 and as needed)"
      ],
      "reference": [
        "difficulty-guide.md (PQ 5-dimension scoring)",
        "pq-scoring-explained.md",
        "breakdown-workflow.md (PQ-specific)",
        "data-contracts.md (generated during Phase 0 Step 3)",
        "query-manifest.md (generated during Phase 0 Step 3)",
        "dependency-graph.md (generated during Phase 0 Step 3)"
      ]
    },
    "calculation-docs": "Source documents (PDFs, Word, Markdown) describing calculation methods",
    "excel-files": "Excel workbooks with Power Query (gitignored by default)",
    "power-query": "Extracted .m files (git tracked, source of truth)",
    "tests": {
      "sample-data": "Test input data",
      "expected-outputs": "Expected results for validation"
    }
  },
  "initialization_questions": [
    {
      "question": "What type of calculation documents do you have?",
      "options": [
        "Regulatory documents (compliance, legal requirements)",
        "Technical specifications (engineering, scientific)",
        "Business logic documents (rules, workflows)",
        "Formula references (mathematical, financial)",
        "Mixed/Multiple types"
      ],
      "impact": "Determines ambiguity resolution strategy and glossary structure"
    },
    {
      "question": "What is the primary source of ambiguity in your project?",
      "options": [
        "Undefined variables and terminology",
        "Unclear calculation logic or formulas",
        "Missing data schemas or column definitions",
        "Inconsistent definitions across documents",
        "All of the above"
      ],
      "impact": "Influences Phase 0 initialization depth and artifact generation"
    },
    {
      "question": "Do you have existing Excel files with Power Query?",
      "options": [
        "Yes - Need to extract and refactor",
        "Yes - Need to extract as-is",
        "No - Building from scratch",
        "Partial - Some queries exist, some new"
      ],
      "impact": "Determines whether to run extract-queries.md command"
    },
    {
      "question": "What is your data pipeline complexity?",
      "options": [
        "Simple (1-5 queries, minimal dependencies)",
        "Moderate (6-15 queries, some dependencies)",
        "Complex (16+ queries, significant dependencies)",
        "Very complex (50+ queries, multi-stage pipeline)"
      ],
      "impact": "Affects dependency graph generation and task breakdown strategy"
    },
    {
      "question": "Are you working with sensitive data?",
      "options": [
        "Yes - Need obfuscation strategy",
        "No - Can use real data for development",
        "Partially - Some sensitive columns"
      ],
      "impact": "Determines data privacy guidance and .gitignore configuration"
    },
    {
      "question": "What is your target deployment environment?",
      "options": [
        "Power BI Desktop",
        "Power BI Service",
        "Excel (desktop)",
        "Excel Online",
        "Multiple environments"
      ],
      "impact": "Affects performance optimization recommendations and validation rules"
    }
  ],
  "typical_tasks": [
    {
      "title": "Run Phase 0 initialization workflow",
      "difficulty": 8,
      "tags": ["phase-0", "setup"],
      "note": "High difficulty - Should be broken down into 4 subtasks (initialize, resolve, generate, extract)"
    },
    {
      "title": "Extract Power Query from Excel files",
      "difficulty": 4,
      "tags": ["extraction", "setup"]
    },
    {
      "title": "Create Bronze layer query (raw data ingestion)",
      "difficulty": 5,
      "tags": ["data-pipeline", "bronze"]
    },
    {
      "title": "Create Silver layer query (cleaned and typed)",
      "difficulty": 6,
      "tags": ["data-pipeline", "silver"]
    },
    {
      "title": "Create Gold layer query (business logic)",
      "difficulty": 7,
      "tags": ["data-pipeline", "gold"],
      "note": "High difficulty - Should be broken down based on 5-dimension scoring"
    },
    {
      "title": "Implement complex calculation with regulatory rules",
      "difficulty": 8,
      "tags": ["calculation", "regulatory"],
      "note": "High difficulty - Requires breakdown and careful ambiguity resolution"
    },
    {
      "title": "Add error handling to query",
      "difficulty": 4,
      "tags": ["error-handling", "refactoring"]
    },
    {
      "title": "Optimize query performance",
      "difficulty": 6,
      "tags": ["performance", "refactoring"]
    },
    {
      "title": "Validate query against schema contract",
      "difficulty": 3,
      "tags": ["validation", "testing"]
    }
  ],
  "dependencies": {
    "required_tools": [
      "VS Code with Excel Power Query Editor extension"
    ],
    "recommended_tools": [
      "Excel (for testing queries)",
      "Power BI Desktop (if targeting Power BI)",
      "Git for version control",
      "Git LFS (if tracking Excel files)"
    ]
  },
  "difficulty_scoring": {
    "description": "Power Query uses 5-dimension difficulty scoring instead of simple 1-10 scale",
    "dimensions": [
      {
        "name": "Logic Complexity",
        "range": "1-10",
        "description": "Algorithmic and calculation complexity"
      },
      {
        "name": "M Language Proficiency",
        "range": "1-10",
        "description": "Required M language expertise level"
      },
      {
        "name": "Dependency Management",
        "range": "1-10",
        "description": "Number and complexity of query dependencies"
      },
      {
        "name": "Data Quality Handling",
        "range": "1-10",
        "description": "Required robustness for null/error/type issues"
      },
      {
        "name": "Specification Ambiguity",
        "range": "1-10",
        "description": "Clarity of requirements and documentation"
      }
    ],
    "aggregation": "Overall difficulty = max(dimensions), with note documenting all 5 scores"
  },
  "phase_0_workflow": {
    "description": "Mandatory Phase 0 ambiguity resolution before any code is written",
    "steps": [
      {
        "step": 1,
        "command": "initialize-project.md",
        "purpose": "Analyze calculation documents and identify all ambiguities"
      },
      {
        "step": 2,
        "command": "resolve-ambiguities.md",
        "purpose": "Interactive ambiguity resolution (batches of 5, can run multiple times)"
      },
      {
        "step": 3,
        "command": "generate-artifacts.md",
        "purpose": "Generate glossary, assumptions, data contracts, query manifest, dependency graph, and tasks"
      },
      {
        "step": 4,
        "command": "extract-queries.md",
        "purpose": "Extract .m files from Excel workbooks (if applicable)"
      }
    ],
    "outputs": [
      ".claude/context/glossary.md",
      ".claude/context/assumptions.md",
      ".claude/reference/data-contracts.md",
      ".claude/reference/query-manifest.md",
      ".claude/reference/dependency-graph.md",
      ".claude/tasks/*.json"
    ]
  },
  "integration_notes": {
    "gemini_api_use_cases": [
      "Research current Power Query best practices and patterns",
      "Regulatory compliance interpretation (with grounding enabled)",
      "Industry-specific calculation validation",
      "Code review for performance and correctness",
      "Data architecture consultation",
      "M language pattern recommendations"
    ],
    "claude_use_cases": [
      "Phase 0 ambiguity resolution and artifact generation",
      "Power Query M code implementation",
      "Query refactoring and optimization",
      "Error handling implementation",
      "Schema validation and testing",
      "Task breakdown using 5-dimension scoring",
      "LLM pitfalls checking before code generation"
    ]
  }
}
