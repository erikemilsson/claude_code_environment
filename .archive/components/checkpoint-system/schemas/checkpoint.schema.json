{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Checkpoint Schema",
  "description": "Schema for checkpoint metadata used to capture and restore project state during task execution",
  "type": "object",
  "required": ["checkpoint_id", "task_id", "timestamp", "type", "files", "task_state"],
  "properties": {
    "checkpoint_id": {
      "type": "string",
      "pattern": "^chk-[0-9]+-[0-9]+$",
      "description": "Unique checkpoint identifier in format chk-{task_id}-{sequence}"
    },
    "task_id": {
      "type": "string",
      "pattern": "^[0-9]+$",
      "description": "ID of the task this checkpoint is associated with"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when checkpoint was created"
    },
    "type": {
      "type": "string",
      "enum": ["pre-execution", "mid-execution", "manual"],
      "description": "Type of checkpoint: pre-execution (automatic before task), mid-execution (during work), manual (user-requested)"
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of what this checkpoint captures"
    },
    "files": {
      "type": "array",
      "description": "List of files captured in this checkpoint",
      "items": {
        "type": "object",
        "required": ["path", "hash", "backup_path"],
        "properties": {
          "path": {
            "type": "string",
            "description": "Original file path relative to project root"
          },
          "hash": {
            "type": "string",
            "description": "SHA-256 hash of file contents for change detection"
          },
          "backup_path": {
            "type": "string",
            "description": "Path to backed up file in .claude/checkpoints/{checkpoint_id}/"
          },
          "existed": {
            "type": "boolean",
            "description": "Whether file existed at checkpoint time (false = file will be created)"
          }
        }
      }
    },
    "task_state": {
      "type": "object",
      "description": "Snapshot of task JSON at checkpoint time",
      "required": ["id", "status"],
      "properties": {
        "id": {"type": "string"},
        "title": {"type": "string"},
        "description": {"type": "string"},
        "difficulty": {"type": "integer"},
        "status": {"type": "string"},
        "created_date": {"type": "string"},
        "updated_date": {"type": "string"},
        "dependencies": {"type": "array", "items": {"type": "string"}},
        "subtasks": {"type": "array", "items": {"type": "string"}},
        "parent_task": {"type": ["string", "null"]},
        "files_affected": {"type": "array", "items": {"type": "string"}},
        "notes": {"type": "string"}
      }
    }
  }
}
